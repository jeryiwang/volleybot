name: Render Keepalive (:47 offset)

on:
  schedule:
    - cron: "*/1 * * * *"   # every minute
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Offset + tiny jitter (land ~:47s)
        run: |
          # Sleep to ~:47 each minute (+0-4s jitter so it doesn't align with other pingers)
          sleep $((47 + RANDOM % 5))

      - name: Curl keepalive (2 tries, 5s apart)
        run: |
          TS=$(date +%s)
          URL="https://volleybot-60hi.onrender.com/keepalive?t=${TS}"
          for i in 1 2; do
            curl -sS -m 10 --retry 2 --retry-delay 2 --retry-connrefused "$URL" -o /dev/null || true
            [ $i -eq 1 ] && sleep 5
          done
